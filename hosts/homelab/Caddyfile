# ============================================================================
# caddy/Caddyfile - Caddy reverse proxy configuration
# ============================================================================
{
  # Global options
  auto_https disable_redirects
  
  # Internal CA for homelab
  local_certs
}

# Main landing page
home.homelab.local {
  reverse_proxy homepage:3000
  tls internal
}

# Nextcloud
nextcloud.homelab.local {
  reverse_proxy nextcloud:80
  tls internal
  
  # Nextcloud-specific headers
  header {
    Strict-Transport-Security "max-age=31536000;"
  }
  
  redir /.well-known/carddav /remote.php/dav 301
  redir /.well-known/caldav /remote.php/dav 301
}

# Vaultwarden
vault.homelab.local {
  reverse_proxy vaultwarden:80
  tls internal
  
  # Security headers
  header {
    Strict-Transport-Security "max-age=31536000;"
    X-Frame-Options "DENY"
    X-Content-Type-Options "nosniff"
  }
}

# CA certificate download endpoint
:8888 {
  root * /data/caddy/pki/authorities/local
  file_server
}


